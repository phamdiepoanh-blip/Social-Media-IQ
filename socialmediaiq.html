<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Social media IQ</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap"stylesheet">
  <style>
    :root{--bg:#07121a;--card:#0b2430;--accent:#7b61ff;--accent2:#66f0d9;--text:#e6fbff}
   html,body {margin: 0;height: 100vh;background: url("file:///D:/Tr%C3%A0/Social%20media%20IQ/n%E1%BB%81n.png") no-repeat center center fixed;background-size: cover;font-family:"Orbitron",monospace;color:var(--text);-webkit-font-smoothing:antialiased;}

    .container{max-width:900px;margin:30px auto;padding:24px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 10px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;align-items:center;gap:18px}
    .logo{width:84px;height:84px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(102,240,217,0.09) inset}
    .logo span{font-size:20px}
    h1{font-size:22px;margin:0}
    p.lead{margin:8px 0 18px;color:rgba(230,251,255,0.85);font-size:18px}

    .stage{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .card{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}

    .intro{min-height:120px;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center}
    .question{font-size:22px;line-height:1.6}
    .typing{font-family:inherit;font-size:20px;color:var(--accent2);min-height:40px}

    .answers{display:flex;flex-direction:column;gap:10px;margin-top:16px}
    .opt{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.05));cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
    .opt.selected{outline:2px solid rgba(123,97,255,0.25);transform:translateY(-2px)}
    .opt input{display:none}
    .opt .bullet{width:20px;height:20px;border-radius:4px;border:2px solid rgba(230,251,255,0.08);display:flex;align-items:center;justify-content:center;font-size:11px}
    .controls{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
    .btn{background:linear-gradient(180deg,var(--accent),#4d27d9);padding:10px 14px;border-radius:8px;border:none;color:white;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04)}

    .side{position:relative}
    .hearts{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .heart{width:28px;height:28px;background:#2a0b12;border-radius:6px;display:flex;align-items:center;justify-content:center;color:#ff6b81;font-weight:900;border:2px solid rgba(255,255,255,0.03)}
    .progress{font-size:11px;color:rgba(230,251,255,0.8)}

    .explain-popup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(0.98);background:linear-gradient(180deg,#081a20,#071318);border:2px solid rgba(123,97,255,0.12);padding:18px;border-radius:12px;min-width:360px;z-index:60;box-shadow:0 20px 60px rgba(0,0,0,0.6);display:none}
    .explain-popup.show{display:block;animation:pop .28s ease}
    @keyframes pop{from{transform:translate(-50%,-50%) scale(.9);opacity:0}to{transform:translate(-50%,-50%) scale(1);opacity:1}}
    .explain-popup p{font-size:22px;margin:8px 0}

    .footer-small{font-size:10px;opacity:0.7;margin-top:12px}

    /* pixel grid overlay */
    .pixel-grid{position:absolute;inset:0;pointer-events:none;background-image:linear-gradient(rgba(255,255,255,0.01) 1px, transparent 1px),linear-gradient(90deg, rgba(255,255,255,0.01) 1px, transparent 1px);background-size:10px 10px,10px 10px;opacity:0.08}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6));z-index:80}
    .modal .box{background:#04131a;padding:18px;border-radius:12px;border:1px solid rgba(123,97,255,0.08);min-width:360px}

    @media (max-width:880px){.stage{grid-template-columns:1fr;}.side{order:-1}}
  </style>
</head>
<body>
<audio id="bg-music" autoplay loop muted>
  <source src="file:///D:/Tr%C3%A0/Social%20media%20IQ/nh%E1%BA%A1c.mp3" type="audio/mpeg">
</audio>

<script>
  document.addEventListener("click", () => {
    const music = document.getElementById("bg-music");
    music.muted = false;
    music.play();
  }, { once: true });
</script>
  </audio>  <div class="container">
    <header>
  <div class="logo">
    <img src="file:///D:/Tr%C3%A0/Social%20media%20IQ/logo.png.png" alt="Logo" style="height: 87px; width: auto;">
  </div>
  <div>
  </div>
</header>


    <div class="stage">
      <div class="card">
        <div class="intro">
          <div class="typing" id="introText"></div>
          <img id="startBtn" src="file:///D:/Tr%C3%A0/Social%20media%20IQ/startbutton.png.png" alt="Start" style="width:200px; cursor:pointer;">
        </div>

        <div id="gameArea" style="display:none">
          <div class="question" id="qText"></div>
          <div class="answers" id="answers"></div>
          <div class="controls">
            <div class="progress" id="qProgress">C√¢u 1 / 10</div>
            <div>
              <button class="btn secondary" id="skipBtn">B·ªè qua</button>
              <button class="btn" id="submitBtn">N·ªôp</button>
            </div>
          </div>
        </div>

      </div>

      <aside class="card side">
        <div class="pixel-grid"></div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="hearts" id="hearts"></div>
            <div class="progress" id="scoreText">ƒêi·ªÉm: 0</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:20px;opacity:0.8">C√≤n l·∫°i</div>
            <div id="remainingText" style="font-weight:900;font-size:18px">5 tim</div>
          </div>
        </div>
        <div style="margin-top:18px;font-size:16px">H∆∞·ªõng d·∫´n: Ch·ªçn ƒë√°nh gi√° c·ªßa b·∫°n ƒë√≥i v·ªõi m·ªói h√†nh vi s·ª≠ d·ª•ng MXH sau theo thang 
üü¢B√¨nh th∆∞·ªùng - üü°C√≥ ch√∫t r·ªßi ro - üî¥Thi·∫øu c·∫©n tr·ªçng. V·ªõi m·ªói ƒë√°p √°n sai ƒë√£ ch·ªçn, b·∫°n m·∫•t 1 tim.</div>
        <div class="footer-small"></div>
      </aside>
    </div>
  </div>

  <div class="explain-popup" id="explainPopup">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong id="expTitle">Gi·∫£i th√≠ch</strong>
      <div id="expIcon">‚ú®</div>
    </div>
    <p id="expText"></p>
    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:8px">
      <button class="btn secondary" id="closeExplain">ƒê√≥ng</button>
      <button class="btn" id="nextBtn">C√¢u ti·∫øp</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="box">
      <h3 id="modalTitle">K·∫øt th√∫c</h3>
      <p id="modalText"></p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn secondary" id="restartBtn">Ch∆°i l·∫°i</button>
        <button class="btn" id="closeModal">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <script>
   // --- game data ---
const QUESTIONS = [
  {
    q: 'Khi b·∫°n bu·ªìn, b·∫°n th∆∞·ªùng vi·∫øt status d√†i ‚Äút√¢m s·ª± th·∫≠t l√≤ng‚Äù l√™n MXH.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:true},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:false}
    ],
    exp: 'Vi·ªác chia s·∫ª c·∫£m x√∫c kh√¥ng x·∫•u, th·∫≠m ch√≠ c√≥ th·ªÉ gi√∫p gi·∫£i t·ªèa v√† nh·∫≠n ƒë∆∞·ª£c s·ª± ƒë·ªìng c·∫£m.\nNh∆∞ng n·∫øu qu√° chi ti·∫øt, qu√° th∆∞·ªùng xuy√™n (overshare), b·∫°n d·ªÖ b·ªã:\n- Ng∆∞·ªùi kh√°c ƒë√°nh gi√°, ch·∫ø gi·ªÖu.\n- K·∫ª x·∫•u l·ª£i d·ª•ng th√¥ng tin c√° nh√¢n ho·∫∑c c·∫£m x√∫c.\n- Ph·ª• thu·ªôc v√†o MXH ƒë·ªÉ t√¨m s·ª± an ·ªßi thay v√¨ chia s·∫ª tr·ª±c ti·∫øp v·ªõi ng∆∞·ªùi th√¢n/b·∫°n b√® ƒë√°ng tin c·∫≠y.\nüëâ V√¨ th·∫ø, ƒë√¢y l√† h√†nh vi c√≥ r·ªßi ro, c·∫ßn ƒëi·ªÅu ch·ªânh ƒë·ªÉ gi·ªØ s·ª± ri√™ng t∆∞ v√† an to√†n t√¢m l√Ω.'
  },
  {
    q: 'B·∫°n ƒëƒÉng 50 ·∫£nh k·ª≥ ngh·ªâ bi·ªÉn, trong ƒë√≥ c√≥ ·∫£nh gia ƒë√¨nh, em nh·ªè v√† bi·ªÉn s·ªë xe.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:false},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:true}
    ],
    exp: 'Vi·ªác chia s·∫ª qu√° nhi·ªÅu ·∫£nh ri√™ng t∆∞ khi·∫øn l·ªô th√¥ng tin nh·∫°y c·∫£m (khu√¥n m·∫∑t tr·∫ª em, bi·ªÉn s·ªë xe, ƒë·ªãa ƒëi·ªÉm). Nh·ªØng chi ti·∫øt n√†y c√≥ th·ªÉ b·ªã k·∫ª x·∫•u l·ª£i d·ª•ng ƒë·ªÉ theo d√µi, gi·∫£ m·∫°o ho·∫∑c x√¢m ph·∫°m ƒë·ªùi s·ªëng ri√™ng t∆∞ c·ªßa b·∫°n v√† gia ƒë√¨nh.'
  },
  {
    q: 'M·ªôt ng√†y b·∫°n ƒëƒÉng 15 story: t·ª´ ƒÉn s√°ng, ƒëi h·ªçc, v√†o l·ªõp, tan h·ªçc, ƒëi ch∆°i, v·ªÅ nh√†.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:true},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:false}
    ],
    exp: 'ƒêƒÉng qu√° nhi·ªÅu story l√†m l·ªô l·ªãch tr√¨nh sinh ho·∫°t h·∫±ng ng√†y. Ng∆∞·ªùi l·∫° c√≥ th·ªÉ theo d√µi th√≥i quen c·ªßa b·∫°n, g√¢y nguy c∆° m·∫•t an to√†n. Ngo√†i ra, b·∫°n c≈©ng d·ªÖ b·ªã ph·ª• thu·ªôc v√†o MXH ƒë·ªÉ ‚Äúkhoe‚Äù m·ªçi ho·∫°t ƒë·ªông thay v√¨ s·ªëng tho·∫£i m√°i ngo√†i ƒë·ªùi.'
  },
  {
    q: 'B·∫°n d√πng ·ª©ng d·ª•ng AI ƒë·ªÉ gh√©p m·∫∑t b·∫°n b√®/gi√°o vi√™n v√†o ·∫£nh ho·∫∑c video h√†i h∆∞·ªõc r·ªìi ƒëƒÉng l√™n MXH cho vui.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:false},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:true}
    ],
    exp: 'D√πng AI gh√©p m·∫∑t c√≥ th·ªÉ l√†m ng∆∞·ªùi kh√°c kh√≥ ch·ªãu, x√¢m ph·∫°m quy·ªÅn ri√™ng t∆∞ v√† danh d·ª±. N·∫øu b·ªã lan truy·ªÅn r·ªông, h√¨nh ·∫£nh ƒë√≥ c√≥ th·ªÉ b·ªã hi·ªÉu sai, g√¢y t·ªïn h·∫°i ƒë·∫øn uy t√≠n c·ªßa ng∆∞·ªùi b·ªã gh√©p m·∫∑t v√† c·∫£ ch√≠nh b·∫°n. Ngo√†i ra, m·ªôt s·ªë ·ª©ng d·ª•ng AI c√≤n l∆∞u tr·ªØ d·ªØ li·ªáu khu√¥n m·∫∑t, ti·ªÅm ·∫©n nguy c∆° b·ªã l·ª£i d·ª•ng v·ªÅ sau.'
  },
  {
    q: 'B·∫°n v√¥ t√¨nh th·∫£ tim m·ªôt b√†i vi·∫øt x√∫c ph·∫°m gi√°o vi√™n. Ng∆∞·ªùi kh√°c ch·ª•p m√†n h√¨nh l·∫°i.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:true},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:false}
    ],
    exp: 'D√π b·∫°n kh√¥ng c·ªë √Ω, h√†nh ƒë·ªông th·∫£ tim c√≥ th·ªÉ b·ªã hi·ªÉu nh·∫ßm l√† ƒë·ªìng t√¨nh v·ªõi n·ªôi dung x√∫c ph·∫°m. ƒêi·ªÅu n√†y ·∫£nh h∆∞·ªüng ƒë·∫øn uy t√≠n v√† m·ªëi quan h·ªá c·ªßa b·∫°n v·ªõi th·∫ßy c√¥. Khi c√≥ b·∫±ng ch·ª©ng ch·ª•p m√†n h√¨nh, vi·ªác gi·∫£i th√≠ch c√†ng kh√≥ khƒÉn. üëâ ƒê√¢y l√† h√†nh vi r·ªßi ro, c·∫ßn c·∫©n th·∫≠n h∆°n khi t∆∞∆°ng t√°c tr√™n MXH.'
  },
  {
    q: 'Khi l∆∞·ªõt m·∫°ng x√£ h·ªôi, b·∫°n th∆∞·ªùng so s√°nh b·∫£n th√¢n v·ªõi h√¨nh ·∫£nh lung linh c·ªßa ng∆∞·ªùi kh√°c, c·∫£m th·∫•y t·ª± ti n√™n ƒëƒÉng nh·ªØng b√†i ‚Äús·ªëng ·∫£o‚Äù ƒë·ªÉ ch·ª©ng t·ªè m√¨nh kh√¥ng thua k√©m.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:true},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:false}
    ],
    exp: 'H√†nh vi n√†y kh√¥ng tr·ª±c ti·∫øp g√¢y nguy hi·ªÉm nh∆∞ l·ªô th√¥ng tin c√° nh√¢n (n√™n kh√¥ng ph·∫£i üî¥).\nNh∆∞ng n√≥ t·∫°o ra √°p l·ª±c t√¢m l√Ω, FOMO, khi·∫øn b·∫°n ch·∫°y theo h√¨nh ·∫£nh ·∫£o, xa r·ªùi gi√° tr·ªã th·∫≠t c·ªßa b·∫£n th√¢n. N·∫øu k√©o d√†i s·∫Ω ·∫£nh h∆∞·ªüng ti√™u c·ª±c ƒë·∫øn t·ª± tin, s·ª©c kh·ªèe tinh th·∫ßn. üëâ ƒê√¢y l√† h√†nh vi c√≥ r·ªßi ro, c·∫ßn ƒëi·ªÅu ch·ªânh.'
  },
  {
    q: 'B·∫°n vi·∫øt b√¨nh lu·∫≠n m·ªâa mai/√°c √Ω.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:false},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:true}
    ],
    exp: 'H√†nh vi n√†y c√≥ th·ªÉ b·ªã coi l√† b·∫Øt n·∫°t tr√™n m·∫°ng (cyberbullying), g√¢y t·ªïn th∆∞∆°ng cho ng∆∞·ªùi kh√°c v√† ·∫£nh h∆∞·ªüng ƒë·∫øn h√¨nh ·∫£nh c·ªßa b·∫°n. B√¨nh lu·∫≠n ti√™u c·ª±c d·ªÖ b·ªã ch·ª•p l·∫°i, lan truy·ªÅn, d·∫´n ƒë·∫øn h·∫≠u qu·∫£ nghi√™m tr·ªçng nh∆∞ m√¢u thu·∫´n, k·ª∑ lu·∫≠t ·ªü tr∆∞·ªùng ho·∫∑c m·∫•t uy t√≠n l√¢u d√†i.'
  },
  {
    q: 'B·∫°n d√πng chung m·∫≠t kh·∫©u Facebook cho nhi·ªÅu t√†i kho·∫£n kh√°c nhau (email, h·ªçc tr·ª±c tuy·∫øn‚Ä¶).',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:false},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:true}
    ],
    exp: 'D√πng chung m·∫≠t kh·∫©u cho nhi·ªÅu t√†i kho·∫£n r·∫•t d·ªÖ b·ªã hack, m·∫•t ki·ªÉm so√°t d·ªØ li·ªáu. üëâ ƒê√¢y l√† h√†nh vi thi·∫øu c·∫©n tr·ªçng, c·∫ßn thay ƒë·ªïi ngay.'
  },
  {
    q: 'B·∫°n d√πng Facebook ƒë·ªÉ ƒëƒÉng k√Ω c√°c website h·ªçc t·∫≠p mi·ªÖn ph√≠. ƒê·ªÉ cho nhanh, b·∫°n c·∫•p quy·ªÅn ‚Äútruy c·∫≠p to√†n b·ªô th√¥ng tin c√° nh√¢n‚Äù m√† kh√¥ng ƒë·ªçc k·ªπ.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:false},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:true}
    ],
    exp: 'Khi cho ph√©p truy c·∫≠p to√†n b·ªô th√¥ng tin c√° nh√¢n (·∫£nh, email, danh b·∫°, b·∫°n b√®‚Ä¶), d·ªØ li·ªáu c·ªßa b·∫°n c√≥ th·ªÉ b·ªã thu th·∫≠p, b√°n ho·∫∑c l·ª£i d·ª•ng cho m·ª•c ƒë√≠ch x·∫•u. Vi·ªác kh√¥ng ki·ªÉm so√°t quy·ªÅn truy c·∫≠p khi·∫øn b·∫°n d·ªÖ b·ªã spam, l·ª´a ƒë·∫£o ho·∫∑c ƒë√°nh c·∫Øp danh t√≠nh.'
  },
  {
    q: 'B·∫°n th·∫•y m·ªôt b√†i vi·∫øt tr√™n MXH n√≥i r·∫±ng ‚ÄúM·ªôt s·ª± ki·ªán l·ªãch s·ª≠ c·ªßa Vi·ªát Nam ƒë√£ b·ªã che gi·∫•u, s·ª± th·∫≠t ho√†n to√†n kh√°c s√°ch gi√°o khoa‚Äù, k√®m theo v√†i h√¨nh ·∫£nh c·∫Øt gh√©p. V√¨ nghƒ© th√∫ v·ªã, b·∫°n chia s·∫ª l·∫°i v·ªõi caption: ‚ÄúH√≥a ra l·ªãch s·ª≠ kh√¥ng nh∆∞ m√¨nh h·ªçc‚Äù.',
    opts: [
      {t:'üü¢ B√¨nh th∆∞·ªùng', ok:false},
      {t:'üü° C√≥ ch√∫t r·ªßi ro', ok:false},
      {t:'üî¥ Thi·∫øu c·∫©n tr·ªçng', ok:true}
    ],
    exp: 'ƒê√¢y c√≥ th·ªÉ l√† tin gi·∫£ ho·∫∑c th√¥ng tin b·ªã c·∫Øt gh√©p sai l·ªách. Chia s·∫ª l·∫°i m√† kh√¥ng ki·ªÉm ch·ª©ng s·∫Ω khi·∫øn b·∫°n v√¥ t√¨nh lan truy·ªÅn tin gi·∫£, ·∫£nh h∆∞·ªüng ƒë·∫øn nh·∫≠n th·ª©c c·ªßa ng∆∞·ªùi kh√°c v√† c·∫£ uy t√≠n c·ªßa b·∫°n.'
  }
];


    // Synthesised simple sounds with WebAudio
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioCtx();
    function clickSound(){
      const o=ctx.createOscillator();const g=ctx.createGain();o.type='square';o.frequency.value=900;g.gain.value=0.02;o.connect(g);g.connect(ctx.destination);o.start();o.stop(ctx.currentTime+0.03);
    }
    function heartLoseSound(){
      const o1=ctx.createOscillator();const o2=ctx.createOscillator();const g=ctx.createGain();o1.type='sawtooth';o2.type='triangle';o1.frequency.value=220;o2.frequency.value=330;g.gain.value=0.05;o1.connect(g);o2.connect(g);g.connect(ctx.destination);o1.start();o2.start();o1.stop(ctx.currentTime+0.28);o2.stop(ctx.currentTime+0.28);
    }
    function synthTap(freq,dur){const o=ctx.createOscillator();const g=ctx.createGain();o.type='sine';o.frequency.value=freq;g.gain.value=0.01;o.connect(g);g.connect(ctx.destination);o.start();o.stop(ctx.currentTime+dur||0.06)}

    // subtle ambient loop
    let ambient;
    function startAmbient(){
      if(ambient) return;
      const gain = ctx.createGain();gain.gain.value=0.004;gain.connect(ctx.destination);
      const o = ctx.createOscillator();o.type='sine';o.frequency.value=110;o.connect(gain);o.start();
      const o2 = ctx.createOscillator();o2.type='sine';o2.frequency.value=55;o2.connect(gain);o2.start();
      ambient = [o,o2,gain];
    }
    function stopAmbient(){if(!ambient) return;ambient.forEach(n=>n.stop&&n.stop());ambient=null}

    // --- UI logic ---
    const introTextEl = document.getElementById('introText');
    const startBtn = document.getElementById('startBtn');
    const gameArea = document.getElementById('gameArea');
    const qText = document.getElementById('qText');
    const answers = document.getElementById('answers');
    const submitBtn = document.getElementById('submitBtn');
    const skipBtn = document.getElementById('skipBtn');
    const qProgress = document.getElementById('qProgress');
    const heartsEl = document.getElementById('hearts');
    const remainingText = document.getElementById('remainingText');
    const scoreText = document.getElementById('scoreText');

    const explainPopup = document.getElementById('explainPopup');
    const expText = document.getElementById('expText');
    const nextBtn = document.getElementById('nextBtn');
    const closeExplain = document.getElementById('closeExplain');

    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalText = document.getElementById('modalText');
    const restartBtn = document.getElementById('restartBtn');
    const closeModal = document.getElementById('closeModal');

    let current = 0; let hearts = 5; let score = 0;
    function renderHearts(){heartsEl.innerHTML='';for(let i=0;i<hearts;i++){const d=document.createElement('div');d.className='heart';d.textContent='‚ù§';heartsEl.appendChild(d);}remainingText.textContent=hearts+' tim';}

    function typeIntro(text,done){let i=0;function step(){if(i<text.length){introTextEl.textContent+=text[i++];clickSound();setTimeout(step,40)}else done&&done();}step();}
    typeIntro('B·∫°n s·ª≠ d·ª•ng m·∫°ng x√£ h·ªôi th√¥ng minh ƒë·∫øn ƒë√¢u?',()=>{});

    startBtn.addEventListener('click',async ()=>{
      // resume audio context on user gesture
      if(ctx.state==='suspended') await ctx.resume();
      startAmbient();
      document.getElementById('startBtn').style.display='none';
      introTextEl.style.opacity='0.9';
      // tiny typing confirmation
      synthTap(700,0.06);
      setTimeout(()=>{gameArea.style.display='block';showQuestion();},400);
    });

    function showQuestion(){
      const q = QUESTIONS[current];
      qProgress.textContent = 'C√¢u ' + (current+1) + ' / ' + QUESTIONS.length;
      qText.textContent = q.q;
      answers.innerHTML = '';
      q.opts.forEach((opt,i)=>{
        const el = document.createElement('label');el.className='opt';el.tabIndex=0;
        el.innerHTML = `<div class="bullet">${String.fromCharCode(65+i)}</div><div style="flex:1">${opt.t}</div>`;
        el.addEventListener('click',()=>{el.classList.toggle('selected');clickSound();});
        answers.appendChild(el);
      });
    }

    submitBtn.addEventListener('click',()=>{
      clickSound();evaluateAnswer();
    });
    skipBtn.addEventListener('click',()=>{clickSound();showExplanation('B·∫°n ƒë√£ b·ªè qua c√¢u h·ªèi n√†y.','H√£y ch√∫ √Ω khi s·ª≠ d·ª•ng MXH.');});

    function evaluateAnswer(){
      const q = QUESTIONS[current];
      const optsEls = Array.from(answers.querySelectorAll('.opt'));
      // determine selections
      const selected = optsEls.map((el,i)=>({i,sel:el.classList.contains('selected')}));
      let wrongCount = 0;let correctCount=0;
      selected.forEach(s=>{
        if(s.sel){
          if(!q.opts[s.i].ok) wrongCount++;
          else correctCount++;
        }
      });
      // hearts penalty: each selected wrong -1 heart
      if(wrongCount>0){
        hearts -= wrongCount;
        if(hearts<0) hearts=0;
        heartLoseSound();
      } else {
        // reward points for selecting correct answers
        score += correctCount * 10;
      }
      renderHearts();scoreText.textContent = 'ƒêi·ªÉm: '+score;
      // Prepare explanation text
      showExplanation(q.exp);
    }

    function showExplanation(txt,subtitle){
      expText.textContent = txt || '';
      explainPopup.classList.add('show');
      // if hearts depleted, show game over when closing
    }

    nextBtn.addEventListener('click',()=>{
      explainPopup.classList.remove('show');
      current++;
      if(hearts<=0){showModal('Thua cu·ªôc','B·∫°n ƒë√£ m·∫•t h·∫øt tim. H√£y th·ª≠ l·∫°i ƒë·ªÉ h·ªçc c√°ch d√πng MXH an to√†n.');return}
      if(current>=QUESTIONS.length){showModal('Ho√†n th√†nh','B·∫°n ƒë√£ ho√†n th√†nh tr√≤ ch∆°i! ƒêi·ªÉm c·ªßa b·∫°n: '+score);return}
      showQuestion();
    });
    closeExplain.addEventListener('click',()=>{explainPopup.classList.remove('show');if(hearts<=0){showModal('Thua cu·ªôc','B·∫°n ƒë√£ m·∫•t h·∫øt tim. H√£y th·ª≠ l·∫°i ƒë·ªÉ h·ªçc c√°ch d√πng MXH an to√†n.');return}});

    function showModal(title,text){modalTitle.textContent=title;modalText.textContent=text;modal.style.display='flex';}
    restartBtn.addEventListener('click',()=>{modal.style.display='none';resetGame();});
    closeModal.addEventListener('click',()=>{modal.style.display='none';});

    function resetGame(){current=0;hearts=5;score=0;renderHearts();scoreText.textContent='ƒêi·ªÉm: 0';showQuestion();}

    // initial hearts
    renderHearts();

    // small accessibility: keyboard toggles
    document.addEventListener('keydown',e=>{
      if(e.key==='Enter' && gameArea.style.display==='block') evaluateAnswer();
    });

    // quick touch: start by clicking intro text as well
    introTextEl.addEventListener('click',()=>startBtn.click());

    // when leaving page, stop audio
    window.addEventListener('beforeunload',()=>{stopAmbient();});
  </script>
</body>
</html>
